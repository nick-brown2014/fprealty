generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model User {
  id                     String         @id @default(cuid())
  email                  String         @unique
  password               String
  firstName              String
  lastName               String
  phoneNumber            String
  emailOptIn             Boolean        @default(false)
  isAdmin                Boolean        @default(false)
  resetToken             String?        @unique
  resetTokenExpiry       DateTime?
  createdAt              DateTime       @default(now())
  updatedAt              DateTime       @updatedAt
  favorites              Favorite[]
  savedSearches          SavedSearch[]
  sessions               Session[]
  accounts               Account[]
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Favorite {
  id        String   @id @default(cuid())
  userId    String
  listingId String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, listingId])
  @@index([userId])
}

model SavedSearch {
  id                  String   @id @default(cuid())
  userId              String
  name                String
  searchQuery         String?
  minPrice            Int?
  maxPrice            Int?
  minBeds             Int?
  minBaths            Int?
  propertyTypes       String[] @default([])
  includeLand         Boolean  @default(false)
  statuses            String[] @default([])
  bounds              Json?
  minSqft             Int?
  maxSqft             Int?
  minLotSize          Float?
  maxLotSize          Float?
  minYearBuilt        Int?
  maxYearBuilt        Int?
  minStories          Int?
  maxStories          Int?
  minGarageSpaces     Int?
  hasPool             Boolean  @default(false)
  hasAC               Boolean  @default(false)
  hasBasement         Boolean  @default(false)
  isWaterfront        Boolean  @default(false)
  hasFireplace        Boolean  @default(false)
  isSeniorCommunity   Boolean  @default(false)
  maxHoaFee           Int?
  hasSpa              Boolean  @default(false)
  isHorseProperty     Boolean  @default(false)
  hasGarage           Boolean  @default(false)
  hasAttachedGarage   Boolean  @default(false)
  hasHeating          Boolean  @default(false)
  minDaysOnMarket     Int?
  maxDaysOnMarket     Int?
  minTaxAmount        Int?
  maxTaxAmount        Int?
  minCoveredSpaces    Int?
  hasVirtualTour      Boolean  @default(false)
  isGreenEnergy       Boolean  @default(false)
  view                String[] @default([])
  flooring            String[] @default([])
  appliances          String[] @default([])
  heatingType         String[] @default([])
  architecturalStyle  String[] @default([])
  fencing             String[] @default([])
  patioFeatures       String[] @default([])
  schoolDistrict      String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Listing {
  listingKey                String    @id
  listingId                 String?
  mlsStatus                 String?
  standardStatus            String?
  propertyType              String?
  propertySubType           String?
  listPrice                 Int?
  originalListPrice         Int?
  closePrice                Int?
  closeDate                 DateTime?
  listingContractDate       DateTime?
  statusChangeTimestamp     DateTime?
  priceChangeTimestamp      DateTime?
  daysOnMarket              Int?

  unparsedAddress           String?
  streetNumber              String?
  streetName                String?
  streetSuffix              String?
  streetDirPrefix           String?
  streetDirSuffix           String?
  unitNumber                String?
  city                      String?
  stateOrProvince           String?
  postalCode                String?
  countyOrParish            String?
  country                   String?

  latitude                  Float?
  longitude                 Float?
  directions                String?
  subdivisionName           String?
  mlsAreaMajor              String?

  bedroomsTotal             Int?
  bathroomsFull             Int?
  bathroomsTotalInteger     Int?
  bathroomsHalf             Int?
  bathroomsThreeQuarter     Int?
  livingArea                Int?
  livingAreaUnits           String?
  lotSizeAcres              Float?
  lotSizeSquareFeet         Float?

  yearBuilt                 Int?
  stories                   Int?
  garageSpaces              Int?
  coveredSpaces             Int?
  newConstructionYN         Boolean   @default(false)

  poolPrivateYN             Boolean?
  spaYN                     Boolean?
  waterfrontYN              Boolean?
  fireplaceYN               Boolean?
  seniorCommunityYN         Boolean?
  horseYN                   Boolean?
  garageYN                  Boolean?
  attachedGarageYN          Boolean?
  heatingYN                 Boolean?
  coolingYN                 Boolean?

  associationYN             Boolean?
  associationFee            Int?
  associationFeeFrequency   String?

  publicRemarks             String?
  virtualTourURLUnbranded   String?
  zoning                    String?

  listAgentFullName         String?
  listAgentMlsId            String?
  listAgentKey              String?
  listOfficeKey             String?
  listOfficeMlsId           String?
  listOfficeName            String?

  taxYear                   Int?
  taxAnnualAmount           Int?
  parcelNumber              String?

  elementarySchool          String?
  middleOrJuniorSchool      String?
  highSchool                String?
  highSchoolDistrict        String?

  photosCount               Int?
  photosChangeTimestamp     DateTime?
  media                     Json?

  appliances                String[]  @default([])
  architecturalStyle        String[]  @default([])
  basement                  String[]  @default([])
  constructionMaterials     String[]  @default([])
  cooling                   String[]  @default([])
  exteriorFeatures          String[]  @default([])
  fencing                   String[]  @default([])
  flooring                  String[]  @default([])
  foundationDetails         String[]  @default([])
  greenEnergyEfficient      String[]  @default([])
  heating                   String[]  @default([])
  interiorFeatures          String[]  @default([])
  laundryFeatures           String[]  @default([])
  lotFeatures               String[]  @default([])
  parkingFeatures           String[]  @default([])
  patioAndPorchFeatures     String[]  @default([])
  poolFeatures              String[]  @default([])
  propertyCondition         String[]  @default([])
  roof                      String[]  @default([])
  sewer                     String[]  @default([])
  utilities                 String[]  @default([])
  view                      String[]  @default([])
  waterSource               String[]  @default([])
  windowFeatures            String[]  @default([])

  mlgCanView                Boolean   @default(true)
  modificationTimestamp     DateTime?
  originatingSystemName     String?

  createdAt                 DateTime  @default(now())
  updatedAt                 DateTime  @updatedAt

  @@index([mlsStatus])
  @@index([standardStatus])
  @@index([propertyType])
  @@index([listPrice])
  @@index([bedroomsTotal])
  @@index([bathroomsTotalInteger])
  @@index([latitude])
  @@index([longitude])
  @@index([city])
  @@index([mlgCanView])
  @@index([modificationTimestamp])
  @@index([listingContractDate])
}

model SyncState {
  id                        String    @id @default("mls-grid-sync")
  lastSyncTimestamp         DateTime?
  lastFullSyncAt            DateTime?
  fullSyncInProgress        Boolean   @default(false)
  fullSyncSkip              Int       @default(0)
  totalListings             Int       @default(0)
  createdAt                 DateTime  @default(now())
  updatedAt                 DateTime  @updatedAt
}
